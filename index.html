<!--[if lt IE 9]>
<p class="chromeframe">浏览器太旧了亲~. 请 <a href="http://browsehappy.com/">升级/更换您的浏览器</a> 或者 <a href="http://www.google.com/chromeframe/?redirect=true">激活 Google Chrome 浏览器内嵌框架</a>.</p>
<![endif]-->

<html xmlns="http://www.w3.org/1999/xhtml">
<html>
<head>
<!-- paste this code into your webpage -->
<html lang="zh"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="stylesheets/style.css" rel="stylesheet" type="text/css">
<link href="stylesheets/bootstrap.min.css" rel="stylesheet" type="text/css">
<script src="javascripts/tablecloth.js"></script>
<script src="javascripts/jquery.min.js"></script>
<script src="javascripts/drag.js"></script>
<script src="javascripts/main.js"></script>
<script src="javascripts/jquery.tmpl.min.js"></script>
<!-- end -->

<script type="text/javascript">


$(document).ready(function(){	
	setPageLabel();
	document.getElementById('keyword').focus();
	var dragImage  = document.getElementById('DragImage');
	dragImage.style.display = "none";
	var player, place;
	for(player=0;player<2;player++){
		for(place=0;place<5;place++)addField(player,SZONE,place);
		for(place=0;place<5;place++)addField(player,MZONE,place);
		addField(player,FIELD,0);
		addField(player,DECK,0);
		addField(player,HAND,0);
		addField(player,GRAVE,0);
		addField(player,EXTRA,0);
		addField(player,REMOVED,0);
	}
	var fields = document.getElementById("fields").getElementsByTagName("div");

	for(var i in fields){
		var card_list = [];
		$.data(fields[i], 'card_list', card_list);
		fields[i].onmouseover = function(){
			this.style.border = "1px solid #ff0000";
			if(dragging == false && putting == true){
				putting = false;
				var dragImage  = document.getElementById('DragImage');
				var card_id = $.data(dragImage, 'card_id');
				addCard(this, card_id);
			}
		}
		fields[i].onmouseout = function(){
			this.style.border = "1px solid #00ffff";
		}
	}
});

function addCard(field, card_id){
	var card_list = $.data(field, 'card_list');
	card_list.push(card_id);
	$.data(field, 'card_list', card_list);
	updateImg(field);
}

function updateImg(field){
	var card_list = $.data(field, 'card_list');
	$(field).empty();
	var width = $(field).width();
	var length = card_list.length;
	var start = width/2 - 22.5*length;
	for(var i in card_list){
		var top, left, right, bottom;
		//var data = $(field).tmplItem().data;
		//if(data.location == HAND){
			top = 3;
			if(45 < (width / length)) left = start + 45*i ;
			else left = (width-45)/(length-1)*i;
		//}
	
	
		$("#thumb-tmpl").tmpl({
		card_id:card_list[i],
		index: i,
		top: top || 0,
		left: left || 0,
		right: right || 0,
		bottom: bottom || 0
		}).appendTo(field);
	}
	var thumbs = field.getElementsByClassName("thumb");
	for (var i in thumbs){
		makeMoveable(thumbs[i],field);
	}
}
</script>

<script type="text/x-jquery-tmpl" id="page-tmpl">
	第 ${current_page} 页 / 共 ${page_num} 页
</script>
<script type="text/x-jquery-tmpl" id="field-tmpl">
	<div class="location_${location}" style="top:${top}px; left:${left}px;"></div>
</script>
<script type="text/x-jquery-tmpl" id="thumb-tmpl">
	<img class='thumb' style="top:${top}px; left:${left}px; right:${right}px; bottom:${bottom}px;cursor:pointer;" src='http://my-card.in/images/cards/ygocore/thumbnail/${card_id}.jpg'>
</script>
</head>

<body>

	<header>
		<h1>残局编辑器</h1>
	</header>
	<div id="main">
		<div id="detail">
			<img id="big_image" src="images/unknow.jpg">
		</div>
		<div id="fields">
		
		</div>
		<div id="search_bar">
			<input class="textfield" id="keyword" type="text" placeholder="输入关键字" value="黑羽">
			<button class="button" id="search" onmouseup="search()">搜索</button>
			<div id="content">
				<div id="result"></div>
			</div>
			<label class="page_label"></label>
			<div id="page_button" style="display:none">
				<button class="btn" type="button" id="prePage" onclick="prePage()">上一页</button>
				<button class="btn" type="button" id="nextPage" onclick="nextPage()">下一页</button>
			</div>
		</div>
	</div>
	
	
	<img src="" id="DragImage" style="cursor:pointer;">

</body>
</html>
